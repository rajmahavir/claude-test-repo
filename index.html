<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Tools Suite | GPS & PDF Tools</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Professional all-in-one toolkit for GPS image watermarking and PDF manipulation. 100% client-side, secure, and private.">
    <meta name="keywords" content="GPS watermark, PDF tools, image processing, PDF converter, PDF merge">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #48bb78;
            --danger-color: #f56565;
            --warning-color: #ed8936;
            --info-color: #4299e1;
            --text-dark: #2d3748;
            --text-light: #718096;
            --bg-light: #f7fafc;
            --bg-white: #ffffff;
            --border-color: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Header Navigation */
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-link:hover {
            color: var(--primary-color);
        }

        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Home Page */
        .hero {
            text-align: center;
            padding: 60px 20px;
            color: white;
        }

        .hero h1 {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .hero p {
            font-size: 1.3em;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .tools-grid {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .tool-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
            cursor: pointer;
        }

        .tool-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
        }

        .tool-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .tool-card h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .tool-card p {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .tool-card ul {
            list-style: none;
            margin-bottom: 25px;
        }

        .tool-card ul li {
            padding: 8px 0;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-card ul li:before {
            content: "‚úì";
            color: var(--success-color);
            font-weight: bold;
        }

        .btn {
            display: inline-block;
            padding: 14px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        /* Container for tool pages */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .tool-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 40px;
            text-align: center;
        }

        .tool-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tool-header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .back-btn {
            display: inline-block;
            margin: 20px 40px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
        }

        .back-btn:hover {
            color: var(--secondary-color);
        }

        .content {
            padding: 40px;
        }

        /* Upload Areas */
        .upload-area {
            border: 3px dashed var(--border-color);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: var(--bg-light);
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: #ebf8ff;
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background: #bee3f8;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 32px;
            background: var(--primary-color);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 16px;
            font-weight: 500;
        }

        .file-label:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Section Styling */
        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 50%;
            font-size: 16px;
            font-weight: 600;
        }

        .file-info {
            margin-top: 16px;
            padding: 16px;
            background: #f0fdf4;
            border-radius: 8px;
            display: none;
            border-left: 4px solid var(--success-color);
            color: #276749;
        }

        .file-info.show {
            display: block;
        }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .setting-item {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .setting-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .setting-item input,
        .setting-item select,
        .setting-item textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: white;
        }

        .setting-item input:focus,
        .setting-item select:focus,
        .setting-item textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Progress Bar */
        .progress-container {
            display: none;
            margin-top: 32px;
            padding: 30px;
            background: var(--bg-light);
            border-radius: 15px;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s;
            border-radius: 5px;
        }

        .progress-text {
            text-align: center;
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
        }

        .progress-percent {
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        /* Preview Grid */
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .preview-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .preview-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        /* Alert Messages */
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .alert-success {
            background: #f0fdf4;
            color: #276749;
            border-left: 4px solid var(--success-color);
        }

        .alert-info {
            background: #ebf8ff;
            color: #2c5282;
            border-left: 4px solid var(--info-color);
        }

        /* Download Buttons */
        .download-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 32px;
            background: var(--success-color);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        /* PDF Tool Specific Styles */
        .tool-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .option-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-color);
        }

        .option-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .option-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .option-desc {
            font-size: 13px;
            color: var(--text-light);
        }

        .page-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding: 20px;
            background: var(--bg-light);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .page-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .page-checkbox:hover {
            border-color: var(--primary-color);
        }

        .page-checkbox.selected {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        /* Responsive Mobile Design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2em;
            }

            .hero p {
                font-size: 1.1em;
            }

            .tools-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .tool-card {
                padding: 30px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 20px;
            }

            .tool-header {
                padding: 30px 20px;
            }

            .tool-header h1 {
                font-size: 2em;
            }

            .download-buttons {
                flex-direction: column;
            }

            .download-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: white;
            margin-top: 60px;
        }

        .footer p {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Main Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo">üõ†Ô∏è All-in-One Tools</div>
            <nav class="nav-links">
                <a class="nav-link" onclick="showPage('home')">Home</a>
                <a class="nav-link" onclick="showPage('gps')">GPS Watermark</a>
                <a class="nav-link" onclick="showPage('pdf-tools')">PDF Tools</a>
                <a class="nav-link" onclick="showPage('pdf-converter')">PDF Converter</a>
            </nav>
        </div>
    </header>

    <!-- Home Page -->
    <div id="home" class="page-section active">
        <div class="hero">
            <h1>All-in-One Professional Tools Suite</h1>
            <p>Powerful tools for image processing and PDF manipulation - 100% client-side, secure, and private</p>
        </div>

        <div class="tools-grid">
            <!-- GPS Watermark Tool -->
            <div class="tool-card" onclick="showPage('gps')">
                <div class="tool-icon">üìç</div>
                <h2>GPS Watermark Processor</h2>
                <p>Professional batch processing of images with GPS data overlays and location watermarks</p>
                <ul>
                    <li>Batch process multiple images</li>
                    <li>Add GPS data from Excel</li>
                    <li>Custom map overlays</li>
                    <li>Export as ZIP or PowerPoint</li>
                </ul>
                <button class="btn">Launch Tool</button>
            </div>

            <!-- PDF Tools -->
            <div class="tool-card" onclick="showPage('pdf-tools')">
                <div class="tool-icon">üìÑ</div>
                <h2>PDF Tools Suite</h2>
                <p>Comprehensive PDF manipulation tools for all your document needs</p>
                <ul>
                    <li>Remove specific pages</li>
                    <li>Merge multiple PDFs</li>
                    <li>Optimize and compress</li>
                    <li>100% client-side processing</li>
                </ul>
                <button class="btn">Launch Tool</button>
            </div>

            <!-- PDF Book Converter -->
            <div class="tool-card" onclick="showPage('pdf-converter')">
                <div class="tool-icon">üìö</div>
                <h2>PDF Book Converter</h2>
                <p>Convert PDFs into book format with proper page spreads for better reading experience</p>
                <ul>
                    <li>Create book-style spreads</li>
                    <li>Perfect for tablets & e-readers</li>
                    <li>Live preview before download</li>
                    <li>Supports all page sizes</li>
                </ul>
                <button class="btn">Launch Tool</button>
            </div>
        </div>

        <div class="footer">
            <p>üîí All processing happens in your browser - your files never leave your device</p>
            <p style="margin-top: 10px; opacity: 0.8;">Built with modern web technologies | 100% Open Source</p>
        </div>
    </div>

    <!-- GPS Watermark Tool Page -->
    <div id="gps" class="page-section">
        <div class="container">
            <div class="tool-header">
                <h1>üìç GPS Watermark Processor</h1>
                <p>Professional batch watermarking with GPS data overlay</p>
            </div>

            <a class="back-btn" onclick="showPage('home')">‚Üê Back to Home</a>

            <div class="content">
                <!-- Excel Upload -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">1</span>
                        Upload Excel File with GPS Data
                    </div>
                    <div class="upload-area" id="gpsExcelUploadArea">
                        <div class="upload-icon">üìÑ</div>
                        <p><strong>Drop your Excel file here</strong></p>
                        <p style="margin-top: 8px;">or click to browse</p>
                        <label for="gpsExcelFile" class="file-label">Choose File</label>
                        <input type="file" id="gpsExcelFile" accept=".xlsx,.xls">
                    </div>
                    <div class="file-info" id="gpsExcelInfo"></div>
                </div>

                <!-- Images Upload -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">2</span>
                        Upload Images to Process
                    </div>
                    <div class="upload-area" id="gpsImagesUploadArea">
                        <div class="upload-icon">üñºÔ∏è</div>
                        <p><strong>Drop multiple images here</strong></p>
                        <p style="margin-top: 8px;">or click to browse</p>
                        <label for="gpsImageFiles" class="file-label">Choose Images</label>
                        <input type="file" id="gpsImageFiles" accept="image/*" multiple>
                    </div>
                    <div class="file-info" id="gpsImagesInfo"></div>
                    <div class="preview-grid" id="gpsImagesPreview"></div>
                </div>

                <!-- Map Overlay Upload -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">3</span>
                        Upload Map Overlay Image
                    </div>
                    <div class="upload-area" id="gpsOverlayUploadArea">
                        <div class="upload-icon">üó∫Ô∏è</div>
                        <p><strong>Drop map overlay image here</strong></p>
                        <p style="margin-top: 8px;">or click to browse</p>
                        <label for="gpsOverlayFile" class="file-label">Choose Overlay</label>
                        <input type="file" id="gpsOverlayFile" accept="image/*">
                    </div>
                    <div class="file-info" id="gpsOverlayInfo"></div>
                    <div class="preview-grid" id="gpsOverlayPreview"></div>
                </div>

                <!-- Settings -->
                <div class="section">
                    <div class="section-title">
                        <span class="section-number">4</span>
                        Configure Settings
                    </div>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>Output Image Size</label>
                            <select id="gpsOutputSize">
                                <option value="1280x960" selected>1280 √ó 960 (Standard)</option>
                                <option value="1920x1080">1920 √ó 1080 (Full HD)</option>
                                <option value="1920x1440">1920 √ó 1440 (4:3)</option>
                                <option value="original">Keep Original Size</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Image Quality (1-100)</label>
                            <input type="number" id="gpsImageQuality" value="90" min="1" max="100">
                        </div>
                        <div class="setting-item">
                            <label>Location Text</label>
                            <input type="text" id="gpsLocationText" value="Your City, State, Country">
                        </div>
                        <div class="setting-item">
                            <label>Address Line</label>
                            <input type="text" id="gpsAddressText" value="Your Address Here">
                        </div>
                        <div class="setting-item">
                            <label>Coordinates</label>
                            <input type="text" id="gpsCoordinatesText" value="Lat XX.XXXX¬∞ Long YY.YYYY¬∞">
                        </div>
                    </div>
                </div>

                <!-- Process Button -->
                <button class="btn" id="gpsProcessBtn" disabled style="width: 100%; padding: 18px; font-size: 1.1em; margin-top: 30px;">
                    Process Images
                </button>

                <!-- Progress -->
                <div class="progress-container" id="gpsProgressContainer">
                    <div class="progress-percent" id="gpsProgressPercent">0%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="gpsProgressFill"></div>
                    </div>
                    <div class="progress-text" id="gpsProgressText">Initializing...</div>
                </div>

                <!-- Results -->
                <div id="gpsResultSection"></div>
            </div>
        </div>
    </div>

    <!-- PDF Tools Page -->
    <div id="pdf-tools" class="page-section">
        <div class="container">
            <div class="tool-header">
                <h1>üìÑ PDF Tools Suite</h1>
                <p>Comprehensive PDF manipulation tools</p>
            </div>

            <a class="back-btn" onclick="showPage('home')">‚Üê Back to Home</a>

            <div class="content">
                <div id="pdfToolsHome">
                    <h2 style="text-align: center; margin-bottom: 30px; color: var(--text-dark);">Choose a Tool</h2>
                    <div class="tool-options">
                        <div class="option-card" onclick="showPdfTool('remove')">
                            <div class="option-icon">‚úÇÔ∏è</div>
                            <div class="option-title">Remove Pages</div>
                            <div class="option-desc">Delete specific pages from your PDF</div>
                        </div>
                        <div class="option-card" onclick="showPdfTool('merge')">
                            <div class="option-icon">üìë</div>
                            <div class="option-title">Merge PDFs</div>
                            <div class="option-desc">Combine multiple PDFs into one</div>
                        </div>
                        <div class="option-card" onclick="showPdfTool('optimize')">
                            <div class="option-icon">‚ö°</div>
                            <div class="option-title">Optimize PDF</div>
                            <div class="option-desc">Reduce file size and compress</div>
                        </div>
                    </div>
                </div>

                <!-- Remove Pages Tool -->
                <div id="pdfRemoveTool" class="hidden">
                    <a class="back-btn" onclick="showPdfTool('home')" style="margin: 0 0 20px 0;">‚Üê Back to PDF Tools</a>

                    <div class="section">
                        <div class="section-title">Remove Pages from PDF</div>
                        <div class="upload-area" id="pdfRemoveUploadArea">
                            <div class="upload-icon">üìÑ</div>
                            <p><strong>Drop your PDF file here</strong></p>
                            <label for="pdfRemoveFile" class="file-label">Choose PDF</label>
                            <input type="file" id="pdfRemoveFile" accept=".pdf">
                        </div>
                        <div class="file-info" id="pdfRemoveInfo"></div>

                        <div id="pdfRemovePageSelector" class="hidden">
                            <p style="margin: 20px 0 10px 0; font-weight: 600;">Select pages to remove:</p>
                            <div class="page-selector" id="pdfRemovePages"></div>
                        </div>

                        <button class="btn" id="pdfRemoveBtn" disabled style="width: 100%; margin-top: 20px;">Remove Selected Pages</button>
                        <div id="pdfRemoveResult"></div>
                    </div>
                </div>

                <!-- Merge PDFs Tool -->
                <div id="pdfMergeTool" class="hidden">
                    <a class="back-btn" onclick="showPdfTool('home')" style="margin: 0 0 20px 0;">‚Üê Back to PDF Tools</a>

                    <div class="section">
                        <div class="section-title">Merge Multiple PDFs</div>
                        <div class="upload-area" id="pdfMergeUploadArea">
                            <div class="upload-icon">üìë</div>
                            <p><strong>Drop multiple PDF files here</strong></p>
                            <label for="pdfMergeFiles" class="file-label">Choose PDFs</label>
                            <input type="file" id="pdfMergeFiles" accept=".pdf" multiple>
                        </div>
                        <div class="file-info" id="pdfMergeInfo"></div>

                        <button class="btn" id="pdfMergeBtn" disabled style="width: 100%; margin-top: 20px;">Merge PDFs</button>
                        <div id="pdfMergeResult"></div>
                    </div>
                </div>

                <!-- Optimize PDF Tool -->
                <div id="pdfOptimizeTool" class="hidden">
                    <a class="back-btn" onclick="showPdfTool('home')" style="margin: 0 0 20px 0;">‚Üê Back to PDF Tools</a>

                    <div class="section">
                        <div class="section-title">Optimize & Compress PDF</div>
                        <div class="upload-area" id="pdfOptimizeUploadArea">
                            <div class="upload-icon">‚ö°</div>
                            <p><strong>Drop your PDF file here</strong></p>
                            <label for="pdfOptimizeFile" class="file-label">Choose PDF</label>
                            <input type="file" id="pdfOptimizeFile" accept=".pdf">
                        </div>
                        <div class="file-info" id="pdfOptimizeInfo"></div>

                        <button class="btn" id="pdfOptimizeBtn" disabled style="width: 100%; margin-top: 20px;">Optimize PDF</button>
                        <div id="pdfOptimizeResult"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Book Converter Page -->
    <div id="pdf-converter" class="page-section">
        <div class="container">
            <div class="tool-header">
                <h1>üìö PDF Book Format Converter</h1>
                <p>Convert PDFs into book format with page spreads</p>
            </div>

            <a class="back-btn" onclick="showPage('home')">‚Üê Back to Home</a>

            <div class="content">
                <div class="section">
                    <div class="section-title">Upload PDF to Convert</div>
                    <div class="upload-area" id="bookConverterUploadArea">
                        <div class="upload-icon">üìö</div>
                        <p><strong>Drop your PDF file here</strong></p>
                        <p style="margin-top: 8px;">Will convert to: Page 1 solo, then paired spreads (2-3, 4-5, 6-7...)</p>
                        <label for="bookConverterFile" class="file-label">Choose PDF</label>
                        <input type="file" id="bookConverterFile" accept=".pdf">
                    </div>
                    <div class="file-info" id="bookConverterInfo"></div>

                    <button class="btn" id="bookConverterBtn" disabled style="width: 100%; margin-top: 20px; padding: 18px; font-size: 1.1em;">
                        Convert to Book Format
                    </button>

                    <div class="progress-container" id="bookConverterProgress">
                        <div class="spinner"></div>
                        <div class="progress-text" id="bookConverterProgressText">Processing PDF...</div>
                    </div>

                    <div id="bookConverterResult"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Page Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function showPdfTool(tool) {
            const tools = ['pdfRemoveTool', 'pdfMergeTool', 'pdfOptimizeTool'];
            const home = document.getElementById('pdfToolsHome');

            if (tool === 'home') {
                home.style.display = 'block';
                tools.forEach(t => document.getElementById(t).classList.add('hidden'));
            } else {
                home.style.display = 'none';
                tools.forEach(t => document.getElementById(t).classList.add('hidden'));
                document.getElementById(`pdf${tool.charAt(0).toUpperCase() + tool.slice(1)}Tool`).classList.remove('hidden');
            }
        }

        // Drag and Drop Setup
        function setupDragDrop(areaId, fileInputId) {
            const area = document.getElementById(areaId);
            const input = document.getElementById(fileInputId);

            if (!area || !input) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                area.addEventListener(eventName, e => {
                    e.preventDefault();
                    e.stopPropagation();
                }, false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                area.addEventListener(eventName, () => area.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                area.addEventListener(eventName, () => area.classList.remove('dragover'), false);
            });

            area.addEventListener('drop', e => {
                const files = e.dataTransfer.files;
                input.files = files;
                input.dispatchEvent(new Event('change'));
            });

            area.addEventListener('click', () => input.click());
        }

        // Initialize all drag and drop areas
        document.addEventListener('DOMContentLoaded', function() {
            // GPS Tool
            setupDragDrop('gpsExcelUploadArea', 'gpsExcelFile');
            setupDragDrop('gpsImagesUploadArea', 'gpsImageFiles');
            setupDragDrop('gpsOverlayUploadArea', 'gpsOverlayFile');

            // PDF Tools
            setupDragDrop('pdfRemoveUploadArea', 'pdfRemoveFile');
            setupDragDrop('pdfMergeUploadArea', 'pdfMergeFiles');
            setupDragDrop('pdfOptimizeUploadArea', 'pdfOptimizeFile');

            // PDF Converter
            setupDragDrop('bookConverterUploadArea', 'bookConverterFile');

            initGPSTool();
            initPDFTools();
            initBookConverter();
        });

        // =====================================================
        // GPS WATERMARK TOOL FUNCTIONALITY
        // =====================================================

        let gpsExcelData = null;
        let gpsImageFiles = [];
        let gpsOverlayFile = null;
        let gpsProcessedImages = [];

        function initGPSTool() {
            // Excel file handler
            document.getElementById('gpsExcelFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                        gpsExcelData = jsonData;

                        document.getElementById('gpsExcelInfo').innerHTML = `
                            <strong>‚úì Loaded:</strong> ${file.name} ‚Ä¢ ${jsonData.length} entries
                        `;
                        document.getElementById('gpsExcelInfo').classList.add('show');
                        checkGpsReadyToProcess();
                    } catch (error) {
                        alert('Error reading Excel file: ' + error.message);
                    }
                };
                reader.readAsArrayBuffer(file);
            });

            // Images file handler
            document.getElementById('gpsImageFiles').addEventListener('change', function(e) {
                gpsImageFiles = Array.from(e.target.files);

                document.getElementById('gpsImagesInfo').innerHTML = `
                    <strong>‚úì Loaded:</strong> ${gpsImageFiles.length} images
                `;
                document.getElementById('gpsImagesInfo').classList.add('show');

                // Show preview
                const previewContainer = document.getElementById('gpsImagesPreview');
                previewContainer.innerHTML = '';

                gpsImageFiles.slice(0, 10).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'preview-item';
                        div.innerHTML = `
                            <img src="${e.target.result}" alt="Image ${index + 1}">
                        `;
                        previewContainer.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                });

                if (gpsImageFiles.length > 10) {
                    const moreDiv = document.createElement('div');
                    moreDiv.className = 'preview-item';
                    moreDiv.innerHTML = `
                        <div style="height: 150px; display: flex; align-items: center; justify-content: center; background: var(--bg-light); color: var(--text-light); font-weight: 600;">
                            +${gpsImageFiles.length - 10} more
                        </div>
                    `;
                    previewContainer.appendChild(moreDiv);
                }

                checkGpsReadyToProcess();
            });

            // Overlay file handler
            document.getElementById('gpsOverlayFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                gpsOverlayFile = file;

                document.getElementById('gpsOverlayInfo').innerHTML = `
                    <strong>‚úì Loaded:</strong> ${file.name}
                `;
                document.getElementById('gpsOverlayInfo').classList.add('show');

                // Show preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('gpsOverlayPreview').innerHTML = `
                        <div class="preview-item">
                            <img src="${e.target.result}" alt="Map Overlay">
                        </div>
                    `;
                };
                reader.readAsDataURL(file);

                checkGpsReadyToProcess();
            });

            // Process button
            document.getElementById('gpsProcessBtn').addEventListener('click', async function() {
                this.disabled = true;
                document.getElementById('gpsProgressContainer').classList.add('show');
                document.getElementById('gpsResultSection').innerHTML = '';

                try {
                    await processGpsImages();
                } catch (error) {
                    alert('Error processing images: ' + error.message);
                    console.error(error);
                }

                this.disabled = false;
            });
        }

        function checkGpsReadyToProcess() {
            const btn = document.getElementById('gpsProcessBtn');
            if (gpsExcelData && gpsImageFiles.length > 0 && gpsOverlayFile) {
                btn.disabled = false;
                btn.textContent = `Process ${gpsImageFiles.length} Images`;
            }
        }

        async function processGpsImages() {
            const progressFill = document.getElementById('gpsProgressFill');
            const progressText = document.getElementById('gpsProgressText');
            const progressPercent = document.getElementById('gpsProgressPercent');
            const outputSize = document.getElementById('gpsOutputSize').value;
            const quality = parseInt(document.getElementById('gpsImageQuality').value) / 100;
            const locationText = document.getElementById('gpsLocationText').value;
            const addressText = document.getElementById('gpsAddressText').value;
            const coordinatesText = document.getElementById('gpsCoordinatesText').value;

            const zip = new JSZip();
            const processedFolder = zip.folder('processed_images');
            gpsProcessedImages = [];

            // Load overlay image
            progressText.textContent = 'Loading map overlay...';
            const overlayImage = await loadImage(gpsOverlayFile);

            const totalImages = Math.min(gpsImageFiles.length, gpsExcelData.length);

            for (let i = 0; i < totalImages; i++) {
                const progress = ((i + 1) / totalImages * 100).toFixed(0);
                progressFill.style.width = progress + '%';
                progressPercent.textContent = progress + '%';
                progressText.textContent = `Processing image ${i + 1} of ${totalImages}...`;

                const imageFile = gpsImageFiles[i];
                const excelRow = gpsExcelData[i];

                const filename = `processed_${String(i + 1).padStart(3, '0')}.jpg`;

                // Load image
                const img = await loadImage(imageFile);

                // Create canvas
                const canvas = document.createElement('canvas');
                let width, height;

                if (outputSize === 'original') {
                    width = img.width;
                    height = img.height;
                } else {
                    [width, height] = outputSize.split('x').map(Number);
                }

                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                // Fill white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, width, height);

                // Draw image (cover mode)
                const imgAspect = img.width / img.height;
                const canvasAspect = width / height;

                let drawWidth, drawHeight, offsetX = 0, offsetY = 0;

                if (imgAspect > canvasAspect) {
                    drawHeight = height;
                    drawWidth = img.width * (height / img.height);
                    offsetX = (width - drawWidth) / 2;
                } else {
                    drawWidth = width;
                    drawHeight = img.height * (width / img.width);
                    offsetY = (height - drawHeight) / 2;
                }

                ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);

                // Draw overlay
                ctx.drawImage(overlayImage, 0, 0, width, height);

                // Add text watermarks
                const scale = width / 1280;
                addGpsWatermarkText(ctx, excelRow, scale, locationText, addressText, coordinatesText);

                // Convert to blob
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', quality));
                processedFolder.file(filename, blob);

                // Store for PPT export
                const dataUrl = canvas.toDataURL('image/jpeg', quality);
                gpsProcessedImages.push({
                    filename: filename,
                    dataUrl: dataUrl
                });
            }

            // Generate ZIP
            progressText.textContent = 'Creating ZIP file...';
            progressFill.style.width = '100%';
            progressPercent.textContent = '100%';

            const zipBlob = await zip.generateAsync({type: 'blob'});
            const zipUrl = URL.createObjectURL(zipBlob);

            // Show result
            document.getElementById('gpsResultSection').innerHTML = `
                <div class="alert alert-success">
                    <strong>‚úì Success!</strong> Processed ${totalImages} images successfully
                </div>
                <div class="download-buttons">
                    <a href="${zipUrl}" download="gps_watermarked_images.zip" class="download-btn">
                        üì• Download ZIP
                    </a>
                    <button onclick="exportGpsToPPT()" class="download-btn">
                        üìä Download PowerPoint
                    </button>
                </div>
            `;
        }

        async function exportGpsToPPT() {
            const progressText = document.getElementById('gpsProgressText');
            progressText.textContent = 'Creating PowerPoint presentation...';

            const pptx = new PptxGenJS();

            pptx.author = 'GPS Watermark Processor';
            pptx.title = 'GPS Watermarked Images';

            for (let img of gpsProcessedImages) {
                const slide = pptx.addSlide();
                slide.addImage({
                    data: img.dataUrl,
                    x: 0,
                    y: 0,
                    w: '100%',
                    h: '100%'
                });
            }

            await pptx.writeFile({ fileName: 'GPS_Watermarked_Images.pptx' });
            progressText.textContent = 'PowerPoint downloaded successfully!';
        }

        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function addGpsWatermarkText(ctx, excelRow, scale, locationText, addressText, coordinatesText) {
            const datetime = formatDateTime(excelRow);

            ctx.fillStyle = 'white';
            ctx.textBaseline = 'top';

            ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
            ctx.shadowBlur = 4 * scale;
            ctx.shadowOffsetX = 2 * scale;
            ctx.shadowOffsetY = 2 * scale;

            ctx.font = `bold ${23 * scale}px Arial`;
            ctx.fillText('GPS Map Camera', 942 * scale, 680 * scale);

            ctx.font = `${45 * scale}px Arial`;
            ctx.fillText(locationText, 380 * scale, 755 * scale);

            ctx.font = `${29 * scale}px Arial`;
            ctx.fillText(addressText, 380 * scale, 810 * scale);
            ctx.fillText(coordinatesText, 380 * scale, 850 * scale);
            ctx.fillText(datetime, 380 * scale, 890 * scale);

            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        }

        function formatDateTime(row) {
            let dateStr = '';
            let timeStr = '';

            if (row.datetime) {
                const date = excelDateToJSDate(row.datetime);
                dateStr = date.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            if (row.Time) {
                const time = excelDateToJSDate(row.Time);
                timeStr = time.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
            }

            return `${dateStr} ${timeStr} GMT +05:30`;
        }

        function excelDateToJSDate(excelDate) {
            if (typeof excelDate === 'number') {
                return new Date((excelDate - 25569) * 86400 * 1000);
            } else if (excelDate instanceof Date) {
                return excelDate;
            }
            return new Date();
        }

        // =====================================================
        // PDF TOOLS FUNCTIONALITY
        // =====================================================

        const { PDFDocument } = PDFLib;

        function initPDFTools() {
            // Remove Pages Tool
            document.getElementById('pdfRemoveFile').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer);
                    const pageCount = pdfDoc.getPageCount();

                    document.getElementById('pdfRemoveInfo').innerHTML = `
                        <strong>‚úì Loaded:</strong> ${file.name} ‚Ä¢ ${pageCount} pages
                    `;
                    document.getElementById('pdfRemoveInfo').classList.add('show');

                    // Show page selector
                    const selector = document.getElementById('pdfRemovePages');
                    selector.innerHTML = '';

                    for (let i = 0; i < pageCount; i++) {
                        const label = document.createElement('label');
                        label.className = 'page-checkbox';
                        label.innerHTML = `
                            <input type="checkbox" value="${i}">
                            <span>Page ${i + 1}</span>
                        `;
                        label.querySelector('input').addEventListener('change', function() {
                            label.classList.toggle('selected', this.checked);
                        });
                        selector.appendChild(label);
                    }

                    document.getElementById('pdfRemovePageSelector').classList.remove('hidden');
                    document.getElementById('pdfRemoveBtn').disabled = false;

                    // Store PDF for later
                    window.currentRemovePdf = { file, pdfDoc };
                } catch (error) {
                    alert('Error loading PDF: ' + error.message);
                }
            });

            document.getElementById('pdfRemoveBtn').addEventListener('click', async function() {
                const checkboxes = document.querySelectorAll('#pdfRemovePages input:checked');
                if (checkboxes.length === 0) {
                    alert('Please select at least one page to remove');
                    return;
                }

                this.disabled = true;
                try {
                    const pagesToRemove = Array.from(checkboxes).map(cb => parseInt(cb.value));
                    const { pdfDoc } = window.currentRemovePdf;

                    // Remove pages in reverse order
                    pagesToRemove.sort((a, b) => b - a);
                    for (let pageIndex of pagesToRemove) {
                        pdfDoc.removePage(pageIndex);
                    }

                    const pdfBytes = await pdfDoc.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);

                    document.getElementById('pdfRemoveResult').innerHTML = `
                        <div class="alert alert-success">
                            <strong>‚úì Success!</strong> Removed ${pagesToRemove.length} pages
                        </div>
                        <div class="download-buttons">
                            <a href="${url}" download="removed_pages.pdf" class="download-btn">
                                üì• Download Modified PDF
                            </a>
                        </div>
                    `;
                } catch (error) {
                    alert('Error removing pages: ' + error.message);
                }
                this.disabled = false;
            });

            // Merge PDFs Tool
            document.getElementById('pdfMergeFiles').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                document.getElementById('pdfMergeInfo').innerHTML = `
                    <strong>‚úì Loaded:</strong> ${files.length} PDF files
                `;
                document.getElementById('pdfMergeInfo').classList.add('show');
                document.getElementById('pdfMergeBtn').disabled = false;

                window.currentMergePdfs = files;
            });

            document.getElementById('pdfMergeBtn').addEventListener('click', async function() {
                this.disabled = true;
                try {
                    const mergedPdf = await PDFDocument.create();

                    for (let file of window.currentMergePdfs) {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await PDFDocument.load(arrayBuffer);
                        const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                        copiedPages.forEach((page) => mergedPdf.addPage(page));
                    }

                    const pdfBytes = await mergedPdf.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);

                    document.getElementById('pdfMergeResult').innerHTML = `
                        <div class="alert alert-success">
                            <strong>‚úì Success!</strong> Merged ${window.currentMergePdfs.length} PDFs
                        </div>
                        <div class="download-buttons">
                            <a href="${url}" download="merged.pdf" class="download-btn">
                                üì• Download Merged PDF
                            </a>
                        </div>
                    `;
                } catch (error) {
                    alert('Error merging PDFs: ' + error.message);
                }
                this.disabled = false;
            });

            // Optimize PDF Tool
            document.getElementById('pdfOptimizeFile').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer);
                    const pageCount = pdfDoc.getPageCount();

                    document.getElementById('pdfOptimizeInfo').innerHTML = `
                        <strong>‚úì Loaded:</strong> ${file.name} ‚Ä¢ ${pageCount} pages ‚Ä¢ ${(file.size / 1024 / 1024).toFixed(2)} MB
                    `;
                    document.getElementById('pdfOptimizeInfo').classList.add('show');
                    document.getElementById('pdfOptimizeBtn').disabled = false;

                    window.currentOptimizePdf = { file, pdfDoc };
                } catch (error) {
                    alert('Error loading PDF: ' + error.message);
                }
            });

            document.getElementById('pdfOptimizeBtn').addEventListener('click', async function() {
                this.disabled = true;
                try {
                    const { pdfDoc, file } = window.currentOptimizePdf;

                    // Save with compression
                    const pdfBytes = await pdfDoc.save({
                        useObjectStreams: true,
                        addDefaultPage: false,
                        objectsPerTick: 50
                    });

                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);

                    const originalSize = file.size / 1024 / 1024;
                    const newSize = blob.size / 1024 / 1024;
                    const reduction = ((1 - newSize / originalSize) * 100).toFixed(1);

                    document.getElementById('pdfOptimizeResult').innerHTML = `
                        <div class="alert alert-success">
                            <strong>‚úì Success!</strong> Optimized PDF
                            <p style="margin-top: 10px;">Original: ${originalSize.toFixed(2)} MB ‚Üí Optimized: ${newSize.toFixed(2)} MB (${reduction}% reduction)</p>
                        </div>
                        <div class="download-buttons">
                            <a href="${url}" download="optimized.pdf" class="download-btn">
                                üì• Download Optimized PDF
                            </a>
                        </div>
                    `;
                } catch (error) {
                    alert('Error optimizing PDF: ' + error.message);
                }
                this.disabled = false;
            });
        }

        // =====================================================
        // PDF BOOK CONVERTER FUNCTIONALITY
        // =====================================================

        function initBookConverter() {
            document.getElementById('bookConverterFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                document.getElementById('bookConverterInfo').innerHTML = `
                    <strong>‚úì Loaded:</strong> ${file.name} ‚Ä¢ ${(file.size / 1024 / 1024).toFixed(2)} MB
                `;
                document.getElementById('bookConverterInfo').classList.add('show');
                document.getElementById('bookConverterBtn').disabled = false;

                window.currentBookPdf = file;
            });

            document.getElementById('bookConverterBtn').addEventListener('click', async function() {
                this.disabled = true;
                document.getElementById('bookConverterProgress').classList.add('show');
                document.getElementById('bookConverterProgressText').textContent = 'Converting to book format...';

                try {
                    const file = window.currentBookPdf;
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer);
                    const pageCount = pdfDoc.getPageCount();

                    // Create new PDF for book format
                    const bookPdf = await PDFDocument.create();

                    // First page alone
                    const [firstPage] = await bookPdf.copyPages(pdfDoc, [0]);
                    bookPdf.addPage(firstPage);

                    // Create paired spreads for remaining pages
                    for (let i = 1; i < pageCount; i += 2) {
                        const pages = [];
                        const indices = [];

                        if (i < pageCount) {
                            indices.push(i);
                        }
                        if (i + 1 < pageCount) {
                            indices.push(i + 1);
                        }

                        if (indices.length === 2) {
                            // Create spread with two pages
                            const copiedPages = await bookPdf.copyPages(pdfDoc, indices);
                            const leftPage = copiedPages[0];
                            const rightPage = copiedPages[1];

                            const { width: w1, height: h1 } = leftPage.getSize();
                            const { width: w2, height: h2 } = rightPage.getSize();

                            const spreadPage = bookPdf.addPage([w1 + w2, Math.max(h1, h2)]);

                            spreadPage.drawPage(leftPage, { x: 0, y: 0 });
                            spreadPage.drawPage(rightPage, { x: w1, y: 0 });
                        } else if (indices.length === 1) {
                            // Last page alone
                            const [lastPage] = await bookPdf.copyPages(pdfDoc, indices);
                            bookPdf.addPage(lastPage);
                        }
                    }

                    const pdfBytes = await bookPdf.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);

                    document.getElementById('bookConverterProgress').classList.remove('show');
                    document.getElementById('bookConverterResult').innerHTML = `
                        <div class="alert alert-success">
                            <strong>‚úì Success!</strong> Converted ${pageCount} pages into book format
                            <p style="margin-top: 10px;">Format: Page 1 solo, then paired spreads (2-3, 4-5, etc.)</p>
                        </div>
                        <div class="download-buttons">
                            <a href="${url}" download="book_format.pdf" class="download-btn">
                                üì• Download Book Format PDF
                            </a>
                        </div>
                    `;
                } catch (error) {
                    document.getElementById('bookConverterProgress').classList.remove('show');
                    alert('Error converting PDF: ' + error.message);
                }

                this.disabled = false;
            });
        }
    </script>
</body>
</html>
